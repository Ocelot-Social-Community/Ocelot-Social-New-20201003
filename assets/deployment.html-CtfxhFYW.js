import{_ as r}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as h,a as s,b as a,e as t,f as l,d as i,r as d,o}from"./app-Blg-8n75.js";const p={};function c(k,e){const n=d("RouteLink");return o(),h("div",null,[e[4]||(e[4]=s('<h1 id="deployment" tabindex="-1"><a class="header-anchor" href="#deployment"><span>Deployment</span></a></h1><p>Before you start the deployment you have to do preparations.</p><h2 id="deployment-preparations" tabindex="-1"><a class="header-anchor" href="#deployment-preparations"><span>Deployment Preparations</span></a></h2><p>Since all deployment methods described here depend on <a href="https://docker.com" target="_blank" rel="noopener noreferrer">Docker</a> and <a href="https://hub.docker.com" target="_blank" rel="noopener noreferrer">DockerHub</a>, you need to create your own organisation on DockerHub and put its name in the <a href="https://github.com/Ocelot-Social-Community/Ocelot-Social/blob/master/package.json" target="_blank" rel="noopener noreferrer">package.json</a> file as your <code>dockerOrganisation</code>.<br> Read more details in the <a href="https://github.com/Ocelot-Social-Community/Ocelot-Social/blob/master/README.md" target="_blank" rel="noopener noreferrer">main README</a> under <a href="https://github.com/Ocelot-Social-Community/Ocelot-Social/blob/master/README.md#usage" target="_blank" rel="noopener noreferrer">Usage</a>.</p><h2 id="deployment-methods" tabindex="-1"><a class="header-anchor" href="#deployment-methods"><span>Deployment Methods</span></a></h2><p>You have the following options for a deployment:</p>',6)),a("ul",null,[a("li",null,[t(n,{to:"/deployment/src/kubernetes/"},{default:l(()=>e[0]||(e[0]=[i("Kubernetes with Helm")])),_:1})])]),e[5]||(e[5]=s(`<h2 id="after-deployment" tabindex="-1"><a class="header-anchor" href="#after-deployment"><span>After Deployment</span></a></h2><p>After the first deployment of the new network on your server, the database is initialized with the default administrator:</p><ul><li>E-mail: <code>admin@example.org</code></li><li>Password: <code>1234</code></li></ul><p><em><strong>ATTENTION:</strong></em> When you are logged in for the first time, please change your (the admin&#39;s) e-mail to an existing one and change your password to a secure one !!!</p><h2 id="using-the-scripts" tabindex="-1"><a class="header-anchor" href="#using-the-scripts"><span>Using the Scripts</span></a></h2><p>To use most of the scripts you have to set the variable <code>CONFIGURATION</code> in your terminal by entering:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># in deployment folder</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># set configuration name to folder name in &#39;configurations&#39; folder (network name)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> export</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CONFIGURATION=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">your-configuration-nam</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">e&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># to check this</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> echo</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $CONFIGURATION</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="secrets-encrypt-decrypt" tabindex="-1"><a class="header-anchor" href="#secrets-encrypt-decrypt"><span>Secrets Encrypt/Decrypt</span></a></h3><p>To encrypt and decrypt the secrets of your network in your terminal set a correct password in a (new) file <code>configurations/&lt;your-configuration-name&gt;/SECRET</code>. If done please enter:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># in deployment folder</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># encrypt secrets</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> scripts/secrets.encrypt.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># decrypt secrets</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> scripts/secrets.decrypt.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="maintenance-mode-on-off" tabindex="-1"><a class="header-anchor" href="#maintenance-mode-on-off"><span>Maintenance Mode On/Off</span></a></h3><p>Activate or deactivate maintenance mode in your terminal:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># in deployment folder</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># activate maintenance mode</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> scripts/cluster.maintenance.sh</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> on</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># deactivate maintenance mode</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> scripts/cluster.maintenance.sh</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> off</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="backup-scripts" tabindex="-1"><a class="header-anchor" href="#backup-scripts"><span>Backup Scripts</span></a></h3><p>Save backups.</p><h4 id="single-backup" tabindex="-1"><a class="header-anchor" href="#single-backup"><span>Single Backup</span></a></h4><p>To save a local backup of the database and uploaded images:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># in deployment folder</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># save backup</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> scripts/cluster.backup.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The backup will be saved into your network folders <code>backup</code> folder in a new folder with the date and time.</p><h5 id="default-database-name" tabindex="-1"><a class="header-anchor" href="#default-database-name"><span>Default Database Name</span></a></h5><p>To execute this script, it may be necessary to set the default database name in Neo4j.</p><p>In our deployments there are cases where the database is called <code>neo4j</code> (used by default) and in other cases <code>graph.db</code> (accidentally happened when we loaded the database into a new cluster).</p><p>In the new deployment with Helm, we set the default database name by the environment variable <code>NEO4J_dbms_default__database</code> in the Helm <code>values.yaml</code>. See <a href="https://neo4j.com/docs/operations-manual/4.4/docker/ref-settings/" target="_blank" rel="noopener noreferrer">Docker-specific configuration settings</a></p>`,23)),a("p",null,[e[2]||(e[2]=i("For more information see ")),t(n,{to:"/neo4j/#database-management-commands"},{default:l(()=>e[1]||(e[1]=[i("Database Management Commands")])),_:1}),e[3]||(e[3]=i("."))]),e[6]||(e[6]=s(`<h4 id="multiple-networks-backup" tabindex="-1"><a class="header-anchor" href="#multiple-networks-backup"><span>Multiple Networks Backup</span></a></h4><p>In order to save several network backups locally, you must define the configuration names of all networks in <code>.env</code>. The template for this is <code>deployment/.env.dist</code>:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># in the deployment folders &#39;.env&#39; set as example</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">BACKUP_CONFIGURATIONS</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;stage.ocelot.social stage.wir.social&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">BACKUP_SAVED_BACKUPS_NUMBER</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">7</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If <code>BACKUP_SAVED_BACKUPS_NUMBER &lt;= 0</code> then no backups will be deleted.</p><p>To actually save all the backups run:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># in deployment folder</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># save all backups listed in &#39;BACKUP_CONFIGURATIONS&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># delete all backups older then the &#39;BACKUP_SAVED_BACKUPS_NUMBER&#39; newest ones</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> scripts/clusters.backup-multiple-servers.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The backups will be saved into your networks folders <code>backup</code> folder in a new folder with the date and time.</p><h4 id="automated-backups" tabindex="-1"><a class="header-anchor" href="#automated-backups"><span>Automated Backups</span></a></h4><p>⚠️ <em>Attention: Please check carefully whether really the oldest backups have been deleted. As shells on different systems behave differently with regard to the commands used in this script.</em></p><p>Install automated backups by a <a href="https://en.wikipedia.org/wiki/Cron" target="_blank" rel="noopener noreferrer">cron job</a>. Be aware of having the bash shell installed to run the script. The environment variables for the automated backups are described above.</p><p>Installing a cron job by editing the cron table file:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># edit cron job table</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> crontab</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>In the editor add the line:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># in cron job table file</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># set a cron job every night at 04am server time</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># min   hour    day     month   weekday command</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      04</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">      *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">       *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">       *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       /root/Ocelot-Social/deployment/scripts/clusters.backup-multiple-servers.sh</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/root/Ocelot-Social/deployment/backup-cron-job.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This way the terminal output is written into a log file named <code>backup-cron-job.log</code> located in the deployment folder.</p><p>Be aware that the server datetime can differ from your local time. Especially by the change between summer and winter time, because servers usually have UTC. Find out the actual difference by running the command <code>date</code> on your server.</p>`,16))])}const u=r(p,[["render",c],["__file","deployment.html.vue"]]),g=JSON.parse('{"path":"/deployment/deployment.html","title":"Deployment","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Deployment Preparations","slug":"deployment-preparations","link":"#deployment-preparations","children":[]},{"level":2,"title":"Deployment Methods","slug":"deployment-methods","link":"#deployment-methods","children":[]},{"level":2,"title":"After Deployment","slug":"after-deployment","link":"#after-deployment","children":[]},{"level":2,"title":"Using the Scripts","slug":"using-the-scripts","link":"#using-the-scripts","children":[{"level":3,"title":"Secrets Encrypt/Decrypt","slug":"secrets-encrypt-decrypt","link":"#secrets-encrypt-decrypt","children":[]},{"level":3,"title":"Maintenance Mode On/Off","slug":"maintenance-mode-on-off","link":"#maintenance-mode-on-off","children":[]},{"level":3,"title":"Backup Scripts","slug":"backup-scripts","link":"#backup-scripts","children":[]}]}],"git":{"createdTime":1736228730000,"updatedTime":1736228730000,"contributors":[{"name":"Ulf Gebhardt","email":"ulf.gebhardt@webcraft-media.de","commits":1}]},"readingTime":{"minutes":2.24,"words":673},"filePathRelative":"deployment/deployment.md","localizedDate":"January 7, 2025","excerpt":"\\n<p>Before you start the deployment you have to do preparations.</p>\\n<h2>Deployment Preparations</h2>\\n<p>Since all deployment methods described here depend on <a href=\\"https://docker.com\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Docker</a> and <a href=\\"https://hub.docker.com\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">DockerHub</a>, you need to create your own organisation on DockerHub and put its name in the <a href=\\"https://github.com/Ocelot-Social-Community/Ocelot-Social/blob/master/package.json\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">package.json</a> file as your <code>dockerOrganisation</code>.<br>\\nRead more details in the <a href=\\"https://github.com/Ocelot-Social-Community/Ocelot-Social/blob/master/README.md\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">main README</a> under <a href=\\"https://github.com/Ocelot-Social-Community/Ocelot-Social/blob/master/README.md#usage\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Usage</a>.</p>"}');export{u as comp,g as data};
